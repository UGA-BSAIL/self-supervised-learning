# Cleaned and wrangled annotations.
annotations_pandas:
  type: pandas.ParquetDataSet
  filepath: data/03_primary/annotations
  versioned: True

# Training data, as TFRecords.
tfrecord_train:
  type: cotton_flower_mot.data_sets.MultiFileDataSet
  dataset: cotton_flower_mot.data_sets.TfRecordsDataSet
  filepath: data/05_model_input/train
  extension: .tfrecord
  versioned: True

# Testing data, as TFRecords.
tfrecord_test:
  type: cotton_flower_mot.data_sets.MultiFileDataSet
  dataset: cotton_flower_mot.data_sets.TfRecordsDataSet
  filepath: data/05_model_input/test
  extension: .tfrecord
  versioned: True

# Training data, as TFRecords.
tfrecord_valid:
  type: cotton_flower_mot.data_sets.MultiFileDataSet
  dataset: cotton_flower_mot.data_sets.TfRecordsDataSet
  filepath: data/05_model_input/valid
  extension: .tfrecord
  versioned: True

# Unannotated data, as TFRecords, with the robot frame minimally visible.
tfrecord_unannotated_no_wheel:
  type: PartitionedDataSet
  dataset:
    type: cotton_flower_mot.data_sets.TfRecordsDataSet
    compressed: true
  path: data/05_model_input/unannotated/no_wheel

# Same, but with the robot structure visible.
tfrecord_unannotated_wheel:
  type: PartitionedDataSet
  dataset:
    type: cotton_flower_mot.data_sets.TfRecordsDataSet
    compressed: true
  path: data/05_model_input/unannotated/wheel

# A version of the unannotated datasets to use for loading. This can
# be more efficient, because it loads all the TFRecords files into
# a single dataset.
tfrecord_unannotated_no_wheel_combined:
  type: cotton_flower_mot.data_sets.TfRecordsDataSet
  filepath: data/05_model_input/unannotated/no_wheel

tfrecord_unannotated_wheel_combined:
  type: cotton_flower_mot.data_sets.TfRecordsDataSet
  filepath: data/05_model_input/unannotated/wheel

# Encompasses all unannotated data.
tfrecord_unannotated_all:
  type: MemoryDataSet
  copy_mode: assign

# Intermediate TF Datasets containing pre-processed data.
training_data:
  type: MemoryDataSet
  copy_mode: assign

testing_data:
  type: MemoryDataSet
  copy_mode: assign

validation_data:
  type: MemoryDataSet
  copy_mode: assign

rotnet_unannotated_data:
  type: MemoryDataSet
  copy_mode: assign

colorization_unannotated_data:
  type: MemoryDataSet
  copy_mode: assign

# Intermediate TF datasets containing pre-processed data with
# clips in-tact. This means that clips are not interleaved and
# frames with no detections are included.
testing_data_clips:
  type: MemoryDataSet
  copy_mode: assign

validation_data_clips:
  type: MemoryDataSet
  copy_mode: assign

_model_args: &model_args
  type: tensorflow.TensorFlowModelDataset
  load_args:
    # Compiling during loading doesn't work with custom loss functions.
    compile: False
  save_args:
    save_format: h5
  versioned: True

# Don't bother copying the untrained model, as this wastes a lot of time
# if your disk is slow.
initial_model:
  type: MemoryDataSet
  copy_mode: assign

initial_rotnet_model:
  type: MemoryDataSet
  copy_mode: assign

initial_colorization_model:
  type: MemoryDataSet
  copy_mode: assign

encoder_model:
  type: MemoryDataSet
  copy_mode: assign

# Saved model from the best epoch.
best_model:
  filepath: ${output_data_dir}/06_models/best.hd5
  << : *model_args

# Saved model from the final epoch.
last_model:
  filepath: ${output_data_dir}/06_models/last.hd5
  << : *model_args

# Saved model, produced at the end of RotNet pre-training.
pretrained_rotnet_model_output:
  filepath: ${output_data_dir}/06_models/pretrained_rotnet.hd5
  << : *model_args

# Same, but a version used as input for transfer learning.
pretrained_rotnet_model:
  filepath: data/06_models/pretrained_rotnet.hd5
  << : *model_args

# Saved model, produced at the end of RotNet pre-training.
pretrained_colorization_model_output:
  filepath: ${output_data_dir}/06_models/pretrained_colorization.hd5
  << : *model_args

# Same, but a version used as input for transfer learning.
pretrained_colorization_model:
  filepath: data/06_models/pretrained_colorization.hd5
  << : *model_args
